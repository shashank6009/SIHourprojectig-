module.exports=[688947,(e,t,r)=>{t.exports=e.x("stream",()=>require("stream"))},792509,(e,t,r)=>{t.exports=e.x("url",()=>require("url"))},921517,(e,t,r)=>{t.exports=e.x("http",()=>require("http"))},524836,(e,t,r)=>{t.exports=e.x("https",()=>require("https"))},406461,(e,t,r)=>{t.exports=e.x("zlib",()=>require("zlib"))},918622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},556704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},832319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},120635,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},324725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},270406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},193695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},961724,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-route-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-route-turbo.runtime.prod.js"))},166748,e=>{"use strict";e.s(["parseISO",()=>n]);var t=e.i(438220),r=e.i(874321),a=e.i(609730);function n(e,n){let h,m,x=()=>(0,r.constructFrom)(n?.in,NaN),v=n?.additionalDigits??2,f=function(e){let t,r={},a=e.split(s.dateTimeDelimiter);if(a.length>2)return r;if(/:/.test(a[0])?t=a[0]:(r.date=a[0],t=a[1],s.timeZoneDelimiter.test(r.date)&&(r.date=e.split(s.timeZoneDelimiter)[0],t=e.substr(r.date.length,e.length))),t){let e=s.timezone.exec(t);e?(r.time=t.replace(e[1],""),r.timezone=e[1]):r.time=t}return r}(e);if(f.date){let e=function(e,t){let r=RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),a=e.match(r);if(!a)return{year:NaN,restDateString:""};let n=a[1]?parseInt(a[1]):null,s=a[2]?parseInt(a[2]):null;return{year:null===s?n:100*s,restDateString:e.slice((a[1]||a[2]).length)}}(f.date,v);h=function(e,t){var r,a,n,s,i,l,d;if(null===t)return new Date(NaN);let h=e.match(o);if(!h)return new Date(NaN);let m=!!h[4],x=u(h[1]),v=u(h[2])-1,f=u(h[3]),g=u(h[4]),R=u(h[5])-1;if(m){return(r=g,a=R,r>=1&&r<=53&&a>=0&&a<=6)?function(e,t,r){let a=new Date(0);a.setUTCFullYear(e,0,4);let n=a.getUTCDay()||7;return a.setUTCDate(a.getUTCDate()+((t-1)*7+r+1-n)),a}(t,g,R):new Date(NaN)}{let e=new Date(0);return(n=t,s=v,i=f,s>=0&&s<=11&&i>=1&&i<=(c[s]||(p(n)?29:28))&&(l=t,(d=x)>=1&&d<=(p(l)?366:365)))?(e.setUTCFullYear(t,v,Math.max(x,f)),e):new Date(NaN)}}(e.restDateString,e.year)}if(!h||isNaN(+h))return x();let g=+h,R=0;if(f.time&&isNaN(R=function(e){var r,a,n;let s=e.match(i);if(!s)return NaN;let o=d(s[1]),l=d(s[2]),u=d(s[3]);return(r=o,a=l,n=u,24===r?0===a&&0===n:n>=0&&n<60&&a>=0&&a<60&&r>=0&&r<25)?o*t.millisecondsInHour+l*t.millisecondsInMinute+1e3*u:NaN}(f.time)))return x();if(f.timezone){if(isNaN(m=function(e){var r;if("Z"===e)return 0;let a=e.match(l);if(!a)return 0;let n="+"===a[1]?-1:1,s=parseInt(a[2]),o=a[3]&&parseInt(a[3])||0;return(r=o)>=0&&r<=59?n*(s*t.millisecondsInHour+o*t.millisecondsInMinute):NaN}(f.timezone)))return x()}else{let e=new Date(g+R),t=(0,a.toDate)(0,n?.in);return t.setFullYear(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()),t.setHours(e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()),t}return(0,a.toDate)(g+R+m,n?.in)}let s={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},o=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,i=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,l=/^([+-])(\d{2})(?::?(\d{2}))?$/;function u(e){return e?parseInt(e):1}function d(e){return e&&parseFloat(e.replace(",","."))||0}let c=[31,null,31,30,31,30,31,31,30,31,30,31];function p(e){return e%400==0||e%4==0&&e%100!=0}},915799,(e,t,r)=>{},819218,e=>{"use strict";e.s(["handler",()=>I,"patchFetch",()=>O,"routeModule",()=>T,"serverHooks",()=>j,"workAsyncStorage",()=>b,"workUnitAsyncStorage",()=>D],819218);var t=e.i(747909),r=e.i(174017),a=e.i(996250),n=e.i(759756),s=e.i(561916),o=e.i(869741),i=e.i(316795),l=e.i(487718),u=e.i(995169),d=e.i(47587),c=e.i(666012),p=e.i(570101),h=e.i(626937),m=e.i(10372),x=e.i(193695);e.i(52474);var v=e.i(600220);e.s(["GET",()=>C,"POST",()=>y],396775);var f=e.i(89171),g=e.i(362693),R=e.i(343747),_=e.i(938790),N=e.i(166748);async function E(e){try{let t=e?(0,N.parseISO)(e):(0,_.subDays)(new Date,1),r=(0,R.format)(t,"yyyy-MM-dd"),a=`${r}T00:00:00.000Z`,n=`${r}T23:59:59.999Z`;console.log(`Rolling up metrics for ${r}`);let{data:s,error:o}=await g.supabaseServer.from("resume_events").select("*").gte("created_at",a).lte("created_at",n);if(o)throw Error(`Failed to fetch events: ${o.message}`);if(!s||0===s.length)return console.log(`No events found for ${r}`),{day:r,users:0,totalEvents:0,avgAtsScore:0,exportConversion:0};let i=s.reduce((e,t)=>(e[t.user_hash]||(e[t.user_hash]=[]),e[t.user_hash].push(t),e),{}),l=Object.keys(i),u=s.length,d=l.map(e=>{let t=i[e],r=t.reduce((e,t)=>(e[t.event_type]=(e[t.event_type]||0)+1,e),{}),a=t.filter(e=>e.metadata?.atsScore).map(e=>e.metadata.atsScore),n=a.length>0?a.reduce((e,t)=>e+t,0)/a.length:null,s=r.INTERVIEW_COMPLETED||0,o=r.PDF_EXPORTED||0;return{user_hash:e,resumes_created:r.INTERVIEW_COMPLETED||0,versions_created:(r.INTERVIEW_COMPLETED||0)+(r.JD_ALIGNED||0),avg_ats_score:n,export_conversion:s>0?o/s:0,mentor_accept_rate:0}}),c=d.map(e=>e.avg_ats_score).filter(e=>null!==e),p=c.length>0?c.reduce((e,t)=>e+t,0)/c.length:0,h=d.length>0?d.reduce((e,t)=>e+t.export_conversion,0)/d.length:0;for(let e of d){let{error:t}=await g.supabaseServer.from("resume_metrics_daily").upsert({day:r,user_hash:e.user_hash,resumes_created:e.resumes_created,versions_created:e.versions_created,avg_ats_score:e.avg_ats_score,export_conversion:e.export_conversion,mentor_accept_rate:e.mentor_accept_rate},{onConflict:"day,user_hash"});t&&console.error(`Failed to upsert metrics for user ${e.user_hash}:`,t)}let{error:m}=await g.supabaseServer.from("resume_metrics_daily").upsert({day:r,user_hash:null,resumes_created:d.reduce((e,t)=>e+t.resumes_created,0),versions_created:d.reduce((e,t)=>e+t.versions_created,0),avg_ats_score:p,export_conversion:h,mentor_accept_rate:0},{onConflict:"day,user_hash"});return m&&console.error("Failed to upsert global metrics:",m),console.log(`Rollup completed for ${r}: ${l.length} users, ${u} events`),{day:r,users:l.length,totalEvents:u,avgAtsScore:p,exportConversion:h}}catch(e){throw console.error("Metrics rollup error:",e),e}}async function y(e){try{let t=e.headers.get("X-CRON-KEY"),r=process.env.CRON_KEY;if(!r)return f.NextResponse.json({error:"CRON_KEY not configured"},{status:500});if(t!==r)return f.NextResponse.json({error:"Invalid cron key"},{status:401});let a=(await e.json().catch(()=>({}))).date,n=await E(a);return f.NextResponse.json({success:!0,data:n})}catch(e){return console.error("Rollup job error:",e),f.NextResponse.json({error:"Failed to run rollup job"},{status:500})}}async function C(e){try{let t=e.headers.get("X-CRON-KEY"),r=process.env.CRON_KEY;if(!r)return f.NextResponse.json({error:"CRON_KEY not configured"},{status:500});if(t!==r)return f.NextResponse.json({error:"Invalid cron key"},{status:401});let a=new URL(e.url).searchParams.get("date"),n=await E(a||void 0);return f.NextResponse.json({success:!0,data:n})}catch(e){return console.error("Rollup job error:",e),f.NextResponse.json({error:"Failed to run rollup job"},{status:500})}}var w=e.i(396775);let T=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/jobs/rollup/route",pathname:"/api/jobs/rollup",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/jobs/rollup/route.ts",nextConfigOutput:"",userland:w}),{workAsyncStorage:b,workUnitAsyncStorage:D,serverHooks:j}=T;function O(){return(0,a.patchFetch)({workAsyncStorage:b,workUnitAsyncStorage:D})}async function I(e,t,a){var f;let g="/api/jobs/rollup/route";g=g.replace(/\/index$/,"")||"/";let R=await T.prepare(e,t,{srcPage:g,multiZoneDraftMode:!1});if(!R)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:_,params:N,nextConfig:E,isDraftMode:y,prerenderManifest:C,routerServerContext:w,isOnDemandRevalidate:b,revalidateOnlyGenerated:D,resolvedPathname:j}=R,O=(0,o.normalizeAppPath)(g),I=!!(C.dynamicRoutes[O]||C.routes[j]);if(I&&!y){let e=!!C.routes[j],t=C.dynamicRoutes[O];if(t&&!1===t.fallback&&!e)throw new x.NoFallbackError}let A=null;!I||T.isDev||y||(A="/index"===(A=j)?"/":A);let S=!0===T.isDev||!I,P=I&&!S,U=e.method||"GET",q=(0,s.getTracer)(),M=q.getActiveScopeSpan(),k={params:N,prerenderManifest:C,renderOpts:{experimental:{cacheComponents:!!E.experimental.cacheComponents,authInterrupts:!!E.experimental.authInterrupts},supportsDynamicResponse:S,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:null==(f=E.experimental)?void 0:f.cacheLife,isRevalidate:P,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>T.onRequestError(e,t,a,w)},sharedContext:{buildId:_}},$=new i.NodeNextRequest(e),H=new i.NodeNextResponse(t),F=l.NextRequestAdapter.fromNodeNextRequest($,(0,l.signalFromNodeResponse)(t));try{let o=async r=>T.handle(F,k).finally(()=>{if(!r)return;r.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=q.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=a.get("next.route");if(n){let e=`${U} ${n}`;r.setAttributes({"next.route":n,"http.route":n,"next.span_name":e}),r.updateName(e)}else r.updateName(`${U} ${e.url}`)}),i=async s=>{var i,l;let u=async({previousCacheEntry:r})=>{try{if(!(0,n.getRequestMeta)(e,"minimalMode")&&b&&D&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await o(s);e.fetchMetrics=k.renderOpts.fetchMetrics;let l=k.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let u=k.renderOpts.collectedTags;if(!I)return await (0,c.sendResponse)($,H,i,k.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,p.toNodeOutgoingHttpHeaders)(i.headers);u&&(t[m.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==k.renderOpts.collectedRevalidate&&!(k.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&k.renderOpts.collectedRevalidate,a=void 0===k.renderOpts.collectedExpire||k.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:k.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await T.onRequestError(e,t,{routerKind:"App Router",routePath:g,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isRevalidate:P,isOnDemandRevalidate:b})},w),t}},x=await T.handleResponse({req:e,nextConfig:E,cacheKey:A,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:C,isRoutePPREnabled:!1,isOnDemandRevalidate:b,revalidateOnlyGenerated:D,responseGenerator:u,waitUntil:a.waitUntil});if(!I)return null;if((null==x||null==(i=x.value)?void 0:i.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==x||null==(l=x.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,n.getRequestMeta)(e,"minimalMode")||t.setHeader("x-nextjs-cache",b?"REVALIDATED":x.isMiss?"MISS":x.isStale?"STALE":"HIT"),y&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let f=(0,p.fromNodeOutgoingHttpHeaders)(x.value.headers);return(0,n.getRequestMeta)(e,"minimalMode")&&I||f.delete(m.NEXT_CACHE_TAGS_HEADER),!x.cacheControl||t.getHeader("Cache-Control")||f.get("Cache-Control")||f.set("Cache-Control",(0,h.getCacheControlHeader)(x.cacheControl)),await (0,c.sendResponse)($,H,new Response(x.value.body,{headers:f,status:x.value.status||200})),null};M?await i(M):await q.withPropagatedContext(e.headers,()=>q.trace(u.BaseServerSpan.handleRequest,{spanName:`${U} ${e.url}`,kind:s.SpanKind.SERVER,attributes:{"http.method":U,"http.target":e.url}},i))}catch(t){if(M||t instanceof x.NoFallbackError||await T.onRequestError(e,t,{routerKind:"App Router",routePath:O,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isRevalidate:P,isOnDemandRevalidate:b})}),I)throw t;return await (0,c.sendResponse)($,H,new Response(null,{status:500})),null}}},236145,e=>{e.v(e=>Promise.resolve().then(()=>e(902808)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__6074518e._.js.map